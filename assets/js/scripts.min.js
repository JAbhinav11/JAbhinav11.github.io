"use strict";const pageLoadTime=Date.now(),elementToggleFunc=function(e){e.classList.toggle("active")};"scrollRestoration"in history&&(history.scrollRestoration="manual");const sidebar=document.querySelector("[data-sidebar]"),sidebarBtn=document.querySelector("[data-sidebar-btn]");sidebarBtn.addEventListener("click",function(){elementToggleFunc(sidebar)});const select=document.querySelector("[data-select]"),selectItems=document.querySelectorAll("[data-select-item]"),selectValue=document.querySelector("[data-selecct-value]"),filterBtn=document.querySelectorAll("[data-filter-btn]");select.addEventListener("click",function(){elementToggleFunc(this)});for(let i=0;i<selectItems.length;i++)selectItems[i].addEventListener("click",function(){let e=this.innerText.toLowerCase();selectValue.innerText=this.innerText,elementToggleFunc(select),filterFunc(e)});const filterItems=document.querySelectorAll("[data-filter-item]"),filterFunc=function(e){for(let t=0;t<filterItems.length;t++)"all"===e?filterItems[t].classList.add("active"):e===filterItems[t].dataset.category?filterItems[t].classList.add("active"):filterItems[t].classList.remove("active")};let lastClickedBtn=filterBtn[0];for(let i=0;i<filterBtn.length;i++)filterBtn[i].addEventListener("click",function(){let e=this.innerText.toLowerCase();selectValue.innerText=this.innerText,filterFunc(e),lastClickedBtn.classList.remove("active"),this.classList.add("active"),lastClickedBtn=this});const dataForm=document.querySelector("[data-form]"),formInputs=document.querySelectorAll("[data-form-input]"),formBtn=document.querySelector("[data-form-btn]"),emailInput=dataForm.querySelector('input[type="email"]'),fileInput=document.getElementById("file-upload");function validateForm(){let e=Array.from(formInputs).every(e=>""!==e.value.trim()),t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailInput.value);e&&t?formBtn.removeAttribute("disabled"):formBtn.setAttribute("disabled","")}const fileLabelText=document.getElementById("file-label-text"),removeFileBtn=document.getElementById("remove-file-btn");fileInput.addEventListener("change",function(){let e=fileInput.files[0];e?"application/pdf"!==e.type?(alert("Only PDF files are allowed."),fileInput.value="",fileLabelText.textContent="Attach PDF (Optional)",removeFileBtn.style.display="none"):e.size>1048576?(alert("File must be under 1MB."),fileInput.value="",fileLabelText.textContent="Attach PDF (Optional)",removeFileBtn.style.display="none"):(fileLabelText.textContent=e.name.length>30?e.name.substring(0,27)+"...":e.name,removeFileBtn.style.display="inline-block"):(fileLabelText.textContent="Attach PDF (Optional)",removeFileBtn.style.display="none")}),removeFileBtn.addEventListener("click",function(){fileInput.value="",fileLabelText.textContent="Attach PDF (Optional)",removeFileBtn.style.display="none"}),formInputs.forEach(e=>{e.addEventListener("input",validateForm)}),validateForm();const form=document.getElementById("contact-form"),button=form.querySelector("button"),buttonSpan=button.querySelector("span");async function appendTrackingData(e){e.append("userAgent",navigator.userAgent);let t=/Mobile|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);e.append("deviceType",t?"Mobile":"Desktop"),e.append("referrer",document.referrer||"Direct"),e.append("pageUrl",window.location.href);let a=await getIPFromIpify();a&&e.append("ipAddress",a);let n=await getIPInfo();n&&e.append("ipInfo",JSON.stringify(n));let l=Math.round((Date.now()-pageLoadTime)/1e3);e.append("timeSpentSeconds",l)}function resetFileUploadUI(){fileInput.value="",fileLabelText.textContent="Attach PDF (Optional)",removeFileBtn.style.display="none"}function toBase64(e){return new Promise((t,a)=>{let n=new FileReader;n.readAsDataURL(e),n.onload=()=>{let e=n.result.split(",")[1];t(e)},n.onerror=a})}async function getIPFromIpify(){try{let e=await fetch("https://api.ipify.org/?format=json"),t=await e.json();if(t&&t.ip)return t.ip}catch(a){}return null}async function getIPInfo(){try{let e=await fetch("https://ipwho.is/?fields=ip,country,city,region,latitude,longitude"),t=await e.json();if(!1!==t.success)return t}catch(a){}return null}form.addEventListener("submit",function(e){e.preventDefault(),button.disabled=!0,buttonSpan.textContent="Sending. . .",grecaptcha.ready(function(){grecaptcha.execute("6LfdbHArAAAAAPeDLaw6tVOunsir0DJs14gteGKi",{action:"submit"}).then(async function(e){let t=new FormData(form),a=fileInput.files[0];if(a){let n=await toBase64(a);t.append("fileData",n),t.append("fileName",a.name)}t.append("g-recaptcha-response",e),await appendTrackingData(t);try{let l=await fetch("https://script.google.com/macros/s/AKfycbxD8-0WMFNDwuZYEX5j67Nt2nl8gge2dF1qYZy10a2AIrIVkSD5_1YfzD8eOLE0oA8B/exec",{method:"POST",body:t});if(console.log("response: ",l),l.ok){let r=await l.json();console.log("Google Script Response: ",r),"success"===r.status?(showToast("success","Thank you! Your message has been sent."),form.reset(),resetFileUploadUI(),validateForm()):r.message.includes("reCAPTCHA failed")?showToast("warning","reCAPTCHA flagged this as suspicious. Please refresh and try again."):r.message.includes("Missing reCAPTCHA token")?showToast("warning","Submission failed. Please refresh and try again."):showToast("error","Error: Could not send the message.")}else showToast("error","Error: Could not send the message.")}catch(s){console.error("Submission error:",s),showToast("error","Something went wrong. Please contact us at hello@iabhinav.me")}finally{buttonSpan.textContent="Send Message"}})})});const navigationLinks=document.querySelectorAll("[data-nav-link]"),pages=document.querySelectorAll("[data-page]");for(let i=0;i<navigationLinks.length;i++)navigationLinks[i].addEventListener("click",function(){for(let e=0;e<pages.length;e++)this.innerHTML.toLowerCase()===pages[e].dataset.page?(pages[e].classList.add("active"),navigationLinks[e].classList.add("active"),window.scrollTo(0,0)):(pages[e].classList.remove("active"),navigationLinks[e].classList.remove("active"))});const startYear=2018,currentYear=new Date().getFullYear(),experienceYears=currentYear-2018;document.getElementById("experience-years").textContent=`+${experienceYears}`;const popup=document.getElementById("popup"),popupImg=popup.querySelector("img");function hidePopup(){popup.classList.remove("show"),setTimeout(()=>{popupImg.removeAttribute("src"),popupImg.removeAttribute("alt")},500)}async function loadResumeData(){let[e,t,a]=await Promise.all([fetch("/assets/files/json/experience.json"),fetch("/assets/files/json/skills.json"),fetch("/assets/files/json/education.json")]),n=await e.json(),l=await t.json(),r=await a.json();renderExperience(n),renderSkills(l),renderEducation(r)}function renderExperience(e){let t=document.querySelector(".experience-list");t.innerHTML="",e.forEach(e=>{let a=document.createElement("li");a.className="timeline-item";let n=Array.isArray(e.points)?e.points.map(e=>`<li>${e}</li>`).join(""):"";a.innerHTML=`
      <h4 class="h4 timeline-item-title">
        ${e.title}
        <p class="timeline-text">${e.company}</p>
      </h4>
      <span>${e.duration}</span>
      <ul class="timeline-text">
        ${n}
      </ul>
    `,t.appendChild(a)})}function renderEducation(e){let t=document.querySelector(".education-list");t.innerHTML="",e.forEach(e=>{let a=document.createElement("li");a.className="timeline-item",a.innerHTML=`
      <h4 class="h4 timeline-item-title">
        ${e.degree}
        <p class="timeline-text">${e.institution}</p>
      </h4>
      <span>${e.duration}</span>
      <p class="timeline-text">${e.description}</p>
    `,t.appendChild(a)})}function renderSkills(e){let t=document.querySelector(".skills-list");t.innerHTML="",e.forEach(e=>{let a=document.createElement("li");a.className="skills-item",a.innerHTML=`
      <div class="title-wrapper">
        <h5 class="h5">${e.name}</h5>
        <data value="${e.value}">${e.value}%</data>
      </div>
      <div class="skill-progress-bg">
        <div class="skill-progress-fill" style="width: ${e.value}%"></div>
      </div>
    `,t.appendChild(a)})}function applyCardTiltEffect(){document.querySelectorAll(".card-wrap").forEach(e=>{let t=e.querySelector(".card"),a=e.querySelector(".card-bg");e.addEventListener("mousemove",n=>{let l=e.getBoundingClientRect(),r=n.clientX-l.left,s=n.clientY-l.top,o=l.width/2,c=l.height/2;t.style.transform=`rotateX(${-((s-c)/c*15)}deg) rotateY(${(r-o)/o*15}deg)`,a.style.transform=`translate(${-((r-o)/o*15)}px, ${-((s-c)/c*15)}px) scale(1.11)`}),e.addEventListener("mouseleave",()=>{t.style.transform="rotateX(0deg) rotateY(0deg)",a.style.transform="translate(0, 0)"})})}document.addEventListener("click",function(e){let t=e.target;if(t.matches("[data-popup-image]")){let a=t.currentSrc,n=t.alt;popupImg.setAttribute("src",a),popupImg.setAttribute("alt",n),popup.classList.add("show")}}),document.addEventListener("keydown",function(e){("Escape"===e.key||" "===e.key)&&popup.classList.contains("show")&&(e.preventDefault(),hidePopup())},{passive:!1}),document.addEventListener("DOMContentLoaded",function(){window.scrollTo(0,0),loadResumeData()});const galleryPopup=document.getElementById("gallery-popup"),popupImage=document.getElementById("popup-image"),popupClose=document.getElementById("popup-close-btn"),prevBtn=document.querySelector(".popup-prev"),nextBtn=document.querySelector(".popup-next");let galleryData=[],currentCardIndex=0,currentImageIndex=0;function renderGallery(e){let t=document.getElementById("cardContainer");t.innerHTML="",e.forEach((e,a)=>{let n=e.images[0],l=n.replace(/\.(jpg|jpeg|png)$/i,".webp"),r=`
      <div class="card-wrap" data-card-index="${a}">
        <div class="card">
          <div class="card-bg">
            <picture>
              <source srcset="${l}" type="image/webp">
              <img src="${n}" alt="${e.title}" loading="lazy" />
            </picture>
          </div>
          <div class="card-info">
            <h2>${e.title}</h2>
            <p>${e.text}</p>
          </div>
        </div>
      </div>
    `;t.insertAdjacentHTML("beforeend",r)}),applyCardTiltEffect(),document.querySelectorAll(".card-wrap").forEach(e=>{e.addEventListener("click",()=>{currentCardIndex=parseInt(e.getAttribute("data-card-index")),currentImageIndex=0,showPopupImage()})})}function showPopupImage(){let e=galleryData[currentCardIndex],t=e.images,a=t[currentImageIndex],n=a.replace(/\.(jpg|jpeg|png)$/i,".webp"),l=0===document.createElement("canvas").toDataURL("image/webp").indexOf("data:image/webp");popupImage.src=l?n:a,galleryPopup.classList.add("show"),document.body.style.overflow="hidden",updateNavigationHint()}function hidePopupImage(){galleryPopup.classList.remove("show"),popupImage.src="",document.body.style.overflow=""}function nextImage(){let e=galleryData[currentCardIndex].images;currentImageIndex=(currentImageIndex+1)%e.length,showPopupImage()}function prevImage(){let e=galleryData[currentCardIndex].images;currentImageIndex=(currentImageIndex-1+e.length)%e.length,showPopupImage()}fetch("/assets/files/json/cards.json").then(e=>e.json()).then(e=>{galleryData=e,renderGallery(e),updateNavigationHint()}),popupClose.addEventListener("click",hidePopupImage),nextBtn.addEventListener("click",nextImage),prevBtn.addEventListener("click",prevImage),document.addEventListener("keydown",e=>{galleryPopup.classList.contains("show")&&(("Escape"===e.code||"Space"===e.code)&&(e.preventDefault(),hidePopupImage()),("ArrowRight"===e.key||"n"===e.key.toLowerCase())&&nextImage(),("ArrowLeft"===e.key||"p"===e.key.toLowerCase())&&prevImage())},{passive:!1});let touchStartX=0;function updateNavigationHint(){let e=document.querySelector(".keys");if(!e)return;let t="ontouchstart"in window||navigator.maxTouchPoints>0;e.textContent=t?"Swipe left/right to navigate":"Use ← and → keys to navigate"}galleryPopup.addEventListener("touchstart",e=>{touchStartX=e.changedTouches[0].screenX},{passive:!0}),galleryPopup.addEventListener("touchend",e=>{let t=e.changedTouches[0].screenX,a=touchStartX-t;Math.abs(a)>50&&(a>0?nextImage():prevImage())}),document.getElementById("gallery-popup").addEventListener("click",e=>{let t=document.querySelector(".popup-inner");t.contains(e.target)||hidePopupImage()});const toastThemes={success:{icon:"checkmark-done-outline",glow:"rgba(0,255,0,0.5)",shadow:"0px 0px 10px 3px rgba(0, 255, 0, 0.1)"},error:{icon:"close-outline",glow:"rgba(255,0,0,0.5)",shadow:"0px 0px 10px 3px rgba(255, 0, 0, 0.1)"},warning:{icon:"alert-outline",glow:"rgba(255,165,0,0.5)",shadow:"0px 0px 10px 3px rgba(255, 165, 0, 0.1)"},info:{icon:"information",glow:"rgba(0,123,255,0.5)",shadow:"0px 0px 10px 3px rgba(0, 123, 255, 0.1)"},default:{icon:"accessibility-outline",glow:"rgba(255,255,255,0.5)",shadow:"0px 0px 10px 3px rgba(255, 255, 255, 0.1)"}};function showToast(e="default",t=""){let a=document.getElementById("toast-container");if(!a)return;let{icon:n,glow:l,shadow:r}=toastThemes[e]||toastThemes.default,s=document.createElement("div");s.className="toast professional";let o=document.createElement("ion-icon");o.setAttribute("name",n);let c=document.createElement("span");c.textContent=t;let p=document.createElement("div");p.className="toast-glow",p.style.background=`radial-gradient(circle, ${l}, transparent 70%)`,s.append(o,c,p),s.classList.add(e),s.style.boxShadow=r,a.appendChild(s),s.onclick=()=>{s.classList.add("fade-out"),setTimeout(()=>s.remove(),500)},setTimeout(()=>{s.classList.add("fade-out"),setTimeout(()=>s.remove(),500)},6500)}